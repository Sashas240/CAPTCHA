<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>WebApp Капча</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { font-family: Arial; text-align: center; margin-top: 50px; }
    #captcha-container { display: block; }
    #captcha-box {
      width:150px; height:150px; margin: auto;
      border: 3px solid #ccc; border-radius:8px;
      position:relative; cursor:pointer;
    }
    #captcha-box.hovered { border-color:#4caf50; background:#e8f5e9; }
    #checkmark {
      display:none;
      position:absolute; top:50%; left:50%;
      transform:translate(-50%,-50%);
      font-size:90px; color:#4caf50;
    }
    #captcha-box.checked #checkmark { display:block; }

    #continue-btn {
      margin-top:30px; padding:12px 30px;
      font-size:18px; border:none; border-radius:6px;
      background:#ccc; color:#555; cursor:not-allowed;
    }
    #continue-btn.enabled {
      background:#4caf50; color:#fff; cursor:pointer;
    }
    #success-message {
      font-size: 20px; color: #4caf50; display: none;
      margin-top: 30px;
    }
  </style>
</head>
<body>

<h2 id="heading">Пожалуйста, пройдите капчу</h2>
<p id="subheading">Наведи на квадрат и нажми на него</p>

<div id="captcha-container">
  <div id="captcha-box">
    <div id="checkmark">&#10004;</div>
  </div>
  <button id="continue-btn" disabled>Продолжить</button>
</div>

<div id="success-message">✅ Капча успешно пройдена! Можете закрыть окно.</div>

<script>
  const box = document.getElementById('captcha-box');
  const btn = document.getElementById('continue-btn');
  const container = document.getElementById('captcha-container');
  const heading = document.getElementById('heading');
  const subheading = document.getElementById('subheading');
  const success = document.getElementById('success-message');

  let hovered = false, checked = false;

  // Если капча уже пройдена — сразу показать успех
  if (localStorage.getItem("captcha_passed") === "true") {
    container.style.display = "none";
    heading.textContent = "Капча уже пройдена";
    subheading.style.display = "none";
    success.style.display = "block";
  }

  box.addEventListener('mouseenter', () => {
    if (!checked) {
      hovered = true;
      box.classList.add('hovered');
    }
  });
  box.addEventListener('mouseleave', () => {
    if (!checked) {
      hovered = false;
      box.classList.remove('hovered');
    }
  });
  box.addEventListener('click', () => {
    if (hovered && !checked) {
      checked = true;
      box.classList.remove('hovered');
      box.classList.add('checked');
      btn.disabled = false;
      btn.classList.add('enabled');
    }
  });

  btn.addEventListener('click', () => {
    if (checked) {
      // Сохраняем, что капча пройдена
      localStorage.setItem("captcha_passed", "true");

      // Отправляем в Telegram, если в WebApp
      if (window.Telegram?.WebApp) {
        Telegram.WebApp.sendData("пройдено");
      }

      // Показываем сообщение и убираем кнопку и капчу
      container.style.display = "none";
      heading.style.display = "none";
      subheading.style.display = "none";
      success.style.display = "block";
    }
  });
</script>

</body>
</html>
